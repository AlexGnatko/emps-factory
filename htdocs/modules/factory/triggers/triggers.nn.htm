<div class="page-header">
    <h1>Remote Command Triggers</h1>
</div>

<p><a class="btn btn-success btn-lg" data-target="#newTrigger" data-toggle="modal">Add a Trigger</a></p>

<table class="table">
    <tr>
        <th width="5%">Id</th>
        <th width="15%">Name</th>
        <th width="40%">Full URL</th>
        <th width="30%">Command</th>
        <th width="10%">Actions</th>
    </tr>
{{foreach from=$lst item="row"}}
    <tr>
        <td>{{$row.id}}</td>
        <td>{{$row.name}}</td>
        <td><code>{{$smarty.const.EMPS_SCRIPT_WEB}}/trigger/{{$row.url}}/{{$row.apikey}}/</code></td>
        <td><code>{{$row.command}}</code></td>
        <td>
            <a class="btn btn-danger" href="javascript:ask_do('Delete?', './?delete={{$row.id}}')"><i class="glyphicon glyphicon-remove"></i></a>
        </td>
    </tr>
{{/foreach}}
</table>

<p><a class="btn btn-success btn-lg" data-target="#newTrigger" data-toggle="modal">Add a Trigger</a></p>

<div class="move-modal modal fade" id="newTrigger" tabindex="-1" role="dialog" aria-hidden="true">

    <div class="modal-dialog">
        <form action="." method="post" class="form" role="form">
            <input type="hidden" name="post_create" value="1"/>
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Add a New Remote Command Trigger</h4>
                </div>
                <div class="modal-body">
                    <p>A trigger runs a command on behalf of root locally and can be invoked by HTTPS externally.</p>
                    <p>A secret key can be generated for each trigger so that only the parties who know the key can
                    invoke the command.</p>
                    <div class="form-group">
                        <label>Name:</label>
                        <input type="text" class="form-control" name="name" />
                        <div class="help-block">The internal name of the trigger, just to tell them apart</div>
                    </div>
                    <div class="form-group">
                        <label>URL key of the trigger:</label>
                        <input type="text" class="form-control" name="url" />
                        <div class="help-block">The part of the URL that will invoke this trigger. Should contain
                        only English alphanumeric characters and hyphens.</div>
                    </div>
                    <div class="form-group">
                        <label>The command:</label>
                        <textarea class="form-control" name="command" rows="3"></textarea>
                        <div class="help-block">A Linux shell command to execute on this trigger.
                        The command will be added to the command queue and will be executed by the EMPS Factory
                        worker script, which runs as root.</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">Add</button>
                </div>
            </div>
        </form>
    </div>
</div>
