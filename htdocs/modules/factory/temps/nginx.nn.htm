{{capture name="common"}}
	server_name		{{$hostname}} ~(^|\.)({{$hostname_escaped}}|{{$hostname_part}}\.{{$upper_host}})$;
	root 			{{$htdocs}}/;

	index index.php;

{{if $access_log}}
	access_log		/var/log/nginx/{{$hostname}}.log awstats;
{{else}}
	access_log		off;
{{/if}}

{{if $error_log}}
	error_log		/var/log/nginx/{{$hostname}}.error.log error;
{{else}}
	error_log		off;
{{/if}}
	
	include /etc/nginx/deny.conf;
	include /etc/nginx/rewrite.conf;

	include /etc/nginx/gzip.conf;
{{/capture}}

server {
	listen			80;
    listen			[::]:80;
{{$smarty.capture.common}}
}

{{if $ssl}}
server {
	listen			443;
    listen			[::]:443;
	ssl				on;
{{if $letsencrypt}}
	ssl_certificate /etc/letsencrypt/live/{{$hostname}}/fullchain.pem; # managed by Certbot
	# path to your cacert.pem
	ssl_certificate_key /etc/letsencrypt/live/{{$hostname}}/privkey.pem; # managed by Certbot
	# path to your privkey.pem
{{else}}
	ssl_certificate /etc/nginx/ssl/{{$hostname}}.pem;    # path to your cacert.pem
	ssl_certificate_key /etc/nginx/ssl/{{$hostname}}.key;    # path to your privkey.pem
{{/if}}
	fastcgi_param   HTTPS               on;
	fastcgi_param   HTTP_SCHEME         https;

{{$smarty.capture.common}}
}
{{/if}}
